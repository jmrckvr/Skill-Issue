# 4-Role Access System - Architecture & Diagrams

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER REQUEST                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ROUTE MATCHING (routes/web.php)   â”‚
        â”‚  â”œâ”€ Public Routes (no auth)         â”‚
        â”‚  â”œâ”€ Auth Required Routes            â”‚
        â”‚  â”œâ”€ Role-Specific Routes            â”‚
        â”‚  â””â”€ Admin Routes                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MIDDLEWARE LAYER                  â”‚
        â”‚  â”œâ”€ auth (verified)                 â”‚
        â”‚  â”œâ”€ guest / applicant / employer    â”‚
        â”‚  â”œâ”€ admin                           â”‚
        â”‚  â””â”€ [Custom Middleware]             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   CONTROLLER LOGIC                  â”‚
        â”‚  â”œâ”€ Input Validation                â”‚
        â”‚  â”œâ”€ Policy Authorization            â”‚
        â”‚  â””â”€ Business Logic                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   POLICIES (app/Policies/)          â”‚
        â”‚  â”œâ”€ JobPolicy                       â”‚
        â”‚  â”œâ”€ JobApplicationPolicy            â”‚
        â”‚  â””â”€ SavedJobPolicy                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   DATABASE OPERATIONS               â”‚
        â”‚  â”œâ”€ Query with Role Filters         â”‚
        â”‚  â”œâ”€ Ownership Checks                â”‚
        â”‚  â””â”€ Enum Role Constraints           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   RESPONSE TO USER                  â”‚
        â”‚  â”œâ”€ Success (200)                   â”‚
        â”‚  â”œâ”€ Redirect (302)                  â”‚
        â”‚  â”œâ”€ Forbidden (403)                 â”‚
        â”‚  â””â”€ Not Found (404)                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Role Hierarchy & Inheritance

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚      GUEST           â”‚
                         â”‚  Can Browse Only     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Upgrade/Login
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    APPLICANT         â”‚
                         â”‚  â€¢ Browse            â”‚
                         â”‚  â€¢ Apply             â”‚
                         â”‚  â€¢ Save Jobs         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                           â”‚
                      â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     EMPLOYER         â”‚    â”‚      ADMIN           â”‚
          â”‚  â€¢ Post Jobs         â”‚    â”‚  â€¢ FULL ACCESS       â”‚
          â”‚  â€¢ Manage Jobs       â”‚    â”‚  â€¢ Manage Users      â”‚
          â”‚  â€¢ Review Apps       â”‚    â”‚  â€¢ Manage Categories â”‚
          â”‚  â€¢ Hire/Reject       â”‚    â”‚  â€¢ Manage All Jobs   â”‚
          â”‚  â€¢ Manage Company    â”‚    â”‚  â€¢ Analytics         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Route Flow Diagram

```
HTTP Request
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                       â”‚
    â–¼                                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  Public Route?   â”‚                                        â”‚
â”‚  (/, /search)    â”‚                                        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
     â”‚                                                       â”‚
     â”œâ”€ YES â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [PASS] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
     â”‚                                                    â”‚  â”‚
     â”œâ”€ NO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚  â”‚
     â”‚               â”‚                                   â”‚  â”‚
     â–¼               â”‚                                   â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                   â”‚  â”‚
â”‚ Authenticated?     â”‚                                   â”‚  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                   â”‚  â”‚
     â”‚               â”‚                                   â”‚  â”‚
     â”œâ”€ NO  â”€â”€â”€â”€â”€â”€â”€â”€â–º [REDIRECT TO LOGIN] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
     â”‚                                                    â”‚  â”‚
     â”œâ”€ YES â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚  â”‚
     â”‚              â”‚                                   â”‚  â”‚
     â–¼              â”‚                                   â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                   â”‚  â”‚
â”‚ Role Check       â”‚â”‚                                   â”‚  â”‚
â”‚ (applicant/      â”‚â”‚                                   â”‚  â”‚
â”‚  employer/admin)â”‚â”‚                                   â”‚  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                   â”‚  â”‚
     â”‚              â”‚                                   â”‚  â”‚
     â”œâ”€ PASS â”€â”€â”€â”€â”€â”€â”â”‚                                   â”‚  â”‚
     â”‚             â”‚â”‚                                   â”‚  â”‚
     â”‚ â”œâ”€ NO â”€â”€â”€â”€â”€â–º[FORBIDDEN]                         â”‚  â”‚
     â”‚             â”‚â”‚                                   â”‚  â”‚
     â”‚ â”œâ”€ YES â”€â”€â”€â”€â”â–¼                                   â”‚  â”‚
     â”‚            â”‚                                    â”‚  â”‚
     â–¼            â–¼                                    â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚  â”‚
â”‚ Policy Check     â”‚                                   â”‚  â”‚
â”‚ (fine-grained    â”‚                                   â”‚  â”‚
â”‚  permission)     â”‚                                   â”‚  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚  â”‚
     â”‚                                                  â”‚  â”‚
     â”œâ”€ PASS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚
     â”‚                          â”‚                      â”‚  â”‚
     â”œâ”€ FAIL â”€â”€â”€â”€â”€â”€â–º [403 FORBIDDEN] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
     â”‚                          â”‚                      â”‚  â”‚
     â–¼                          â–¼                      â”‚  â”‚
[EXECUTE CONTROLLER]   [RESPONSE]                     â”‚  â”‚
     â”‚                          â”‚                      â”‚  â”‚
     â–¼                          â”‚                      â”‚  â”‚
[DATABASE QUERY]               â”‚                      â”‚  â”‚
     â”‚                          â”‚                      â”‚  â”‚
     â–¼                          â”‚                      â”‚  â”‚
[RETURN RESPONSE]              â”‚                      â”‚  â”‚
     â”‚                          â”‚                      â”‚  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                 â”‚                        â”‚
                                 â–¼                        â”‚
                         [RESPOND TO USER] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Middleware Chain

```
Request
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Route Matching        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware Stack      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. EncryptCookies     â”‚
â”‚ 2. AddQueuedCookies   â”‚
â”‚ 3. StartSession       â”‚
â”‚ 4. ShareErrorsFromSession
â”‚ 5. VerifyCsrfToken    â”‚
â”‚ 6. Authenticate (auth)â”‚
â”‚ 7. [SPECIFIC MIDDLEWARE] â”‚
â”‚    â”œâ”€ GuestMiddleware     â”‚
â”‚    â”œâ”€ ApplicantMiddleware â”‚
â”‚    â”œâ”€ EmployerMiddleware  â”‚
â”‚    â””â”€ AdminMiddleware     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
Response
```

---

## Authorization Policy Flow

```
Controller Action
    â”‚
    â”œâ”€ $this->authorize('action', $model)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Find Corresponding Policy       â”‚
â”‚ (e.g., JobPolicy for Job model)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Call Policy Method â”‚
            â”‚ (e.g., update())   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Check Conditions   â”‚
            â”‚ â€¢ User role check  â”‚
            â”‚ â€¢ Ownership check  â”‚
            â”‚ â€¢ Status check     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
        â–¼                         â–¼
    [TRUE]                    [FALSE]
        â”‚                         â”‚
        â–¼                         â–¼
   [ALLOW]              [THROW EXCEPTION]
        â”‚                         â”‚
        â–¼                         â–¼
 Continue Execution      AuthorizationException
        â”‚                         â”‚
        â–¼                         â–¼
 [HTTP 200]              [HTTP 403 Forbidden]
```

---

## Database Role Enum Values

```
users table
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id           â”‚ 1, 2, 3, 4...            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ name         â”‚ John Doe, Jane Smith...  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ email        â”‚ john@example.com...      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ password     â”‚ hashed_password...       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ role         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚              â”‚ â”‚ ENUM VALUES:        â”‚  â”‚
â”‚              â”‚ â”œâ”€ 'guest'            â”‚  â”‚
â”‚              â”‚ â”œâ”€ 'applicant'        â”‚  â”‚
â”‚              â”‚ â”œâ”€ 'employer'         â”‚  â”‚
â”‚              â”‚ â””â”€ 'admin'            â”‚  â”‚
â”‚              â”‚ DEFAULT: 'guest'      â”‚  â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ is_active    â”‚ true/false               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ created_at   â”‚ timestamp                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ updated_at   â”‚ timestamp                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature Access Matrix - Visual

```
                    GUEST  â”‚  APPLICANT  â”‚  EMPLOYER  â”‚  ADMIN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
Browse Jobs            âœ…   â”‚      âœ…     â”‚     âœ…     â”‚   âœ…
View Job Details       âœ…   â”‚      âœ…     â”‚     âœ…     â”‚   âœ…
Search Jobs            âœ…   â”‚      âœ…     â”‚     âœ…     â”‚   âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
Apply for Jobs         âŒ   â”‚      âœ…     â”‚     âŒ     â”‚   âŒ
Save Jobs              âŒ   â”‚      âœ…     â”‚     âŒ     â”‚   âŒ
Withdraw Application   âŒ   â”‚      âœ…     â”‚     âŒ     â”‚   âŒ
View My Applications   âŒ   â”‚      âœ…     â”‚     âŒ     â”‚   âŒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
Post Job               âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Edit Own Job           âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Publish/Close Job      âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Delete Job             âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
View Applicants        âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Review Applications    âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Accept/Hire Applicant  âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Reject Applicant       âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
Manage Company         âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
Employer Dashboard     âŒ   â”‚      âŒ     â”‚     âœ…     â”‚   âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
Manage All Users       âŒ   â”‚      âŒ     â”‚     âŒ     â”‚   âœ…
Manage All Jobs        âŒ   â”‚      âŒ     â”‚     âŒ     â”‚   âœ…
Manage Categories      âŒ   â”‚      âŒ     â”‚     âŒ     â”‚   âœ…
Admin Dashboard        âŒ   â”‚      âŒ     â”‚     âŒ     â”‚   âœ…
Platform Settings      âŒ   â”‚      âŒ     â”‚     âŒ     â”‚   âœ…
```

---

## Application Workflow - Job Application Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     JOB POSTED                          â”‚
â”‚              (Employer Published Job)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  APPLICANT VIEWS JOB           â”‚
        â”‚  â”œâ”€ Browse job list            â”‚
        â”‚  â”œâ”€ View job details           â”‚
        â”‚  â””â”€ Click "Apply" button       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SUBMIT APPLICATION            â”‚
        â”‚  â”œâ”€ Upload Resume              â”‚
        â”‚  â”œâ”€ Add Cover Letter (optional)â”‚
        â”‚  â””â”€ Submit (creates record)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        Status: 'pending'â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ EMPLOYER REVIEWS APPLICATION   â”‚
        â”‚ â”œâ”€ Views applicants list       â”‚
        â”‚ â”œâ”€ Downloads resume            â”‚
        â”‚ â””â”€ Reviews cover letter        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         Status: 'reviewed'
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                    â”‚
         â–¼                     â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ACCEPTED  â”‚    â”‚   REJECTED   â”‚    â”‚  [NO ACTION] â”‚
    â”‚ (Hire App)  â”‚    â”‚(Reject App)  â”‚    â”‚  (Pending)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚
         â–¼                   â–¼
    Status:            Status:
    'accepted'         'rejected'
         â”‚                   â”‚
         â–¼                   â–¼
    [APPLICANT    [APPLICANT NOTIFIED]
     HIRED]

OR

APPLICANT CAN WITHDRAW AT ANY POINT
         â”‚
         â–¼
    Status: 'withdrawn'
         â”‚
         â–¼
    [APPLICATION CANCELED]
```

---

## File Structure Tree

```
app/
â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”œâ”€â”€ JobController.php âœ… UPDATED
â”‚   â”‚   â”œâ”€â”€ JobApplicationController.php âœ… UPDATED
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ Middleware/
â”‚       â”œâ”€â”€ GuestMiddleware.php âœ… CREATED
â”‚       â”œâ”€â”€ ApplicantMiddleware.php âœ… CREATED
â”‚       â”œâ”€â”€ JobSeekerMiddleware.php âœ… UPDATED
â”‚       â”œâ”€â”€ EmployerMiddleware.php âœ… UPDATED
â”‚       â”œâ”€â”€ AdminMiddleware.php âœ… UPDATED
â”‚       â””â”€â”€ ...
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ User.php âœ… UPDATED
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Policies/
â”‚   â”œâ”€â”€ JobPolicy.php âœ… CREATED
â”‚   â”œâ”€â”€ JobApplicationPolicy.php âœ… CREATED
â”‚   â”œâ”€â”€ SavedJobPolicy.php âœ… CREATED
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Traits/
â”‚   â”œâ”€â”€ AuthorizesRequests.php âœ… CREATED
â”‚   â””â”€â”€ ...
â””â”€â”€ Providers/
    â”œâ”€â”€ AppServiceProvider.php âœ… UPDATED
    â””â”€â”€ ...

database/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 0001_01_01_000000_create_users_table.php (has role enum)
â”‚   â”œâ”€â”€ 2025_12_02_000000_update_users_table_with_guest_role.php âœ… CREATED
â”‚   â””â”€â”€ ...
â””â”€â”€ ...

routes/
â”œâ”€â”€ web.php âœ… UPDATED
â””â”€â”€ ...

bootstrap/
â”œâ”€â”€ app.php âœ… UPDATED (middleware registration)
â””â”€â”€ ...

ğŸ“„ Documentation Files:
â”œâ”€â”€ 4_ROLE_ACCESS_SYSTEM.md âœ… CREATED
â”œâ”€â”€ 4_ROLE_IMPLEMENTATION_CHECKLIST.md âœ… CREATED
â”œâ”€â”€ 4_ROLE_QUICK_REFERENCE.md âœ… CREATED
â”œâ”€â”€ 4_ROLE_IMPLEMENTATION_SUMMARY.md âœ… CREATED
â””â”€â”€ 4_ROLE_ARCHITECTURE_DIAGRAMS.md (this file)
```

---

## Data Flow - User Role Upgrade Example

```
USER REGISTRATION
    â”‚
    â”œâ”€ User fills signup form
    â”‚  â”œâ”€ Name
    â”‚  â”œâ”€ Email
    â”‚  â”œâ”€ Password
    â”‚  â””â”€ [ROLE SELECTION - Optional]
    â”‚      â”œâ”€ I want to find jobs (Applicant)
    â”‚      â””â”€ I want to post jobs (Employer)
    â”‚
    â–¼
CREATE USER IN DATABASE
    â”‚
    â”œâ”€ INSERT INTO users
    â”‚  â”œâ”€ name = 'Jane Doe'
    â”‚  â”œâ”€ email = 'jane@example.com'
    â”‚  â”œâ”€ password = [hashed]
    â”‚  â”œâ”€ role = 'applicant' (selected)
    â”‚  â”œâ”€ is_active = true
    â”‚  â””â”€ created_at = now()
    â”‚
    â–¼
SEND VERIFICATION EMAIL
    â”‚
    â”œâ”€ User verifies email
    â”‚  â””â”€ email_verified_at = now()
    â”‚
    â–¼
USER CAN NOW PERFORM ROLE-SPECIFIC ACTIONS
    â”‚
    â”œâ”€ Applicant: Can apply for jobs
    â”œâ”€ Employer: Can post jobs
    â””â”€ Admin: Can manage platform
```

---

## Error Handling Flow

```
UNAUTHORIZED REQUEST
    â”‚
    â”œâ”€ Guest tries to apply
    â”‚  â”œâ”€ User has role = 'guest'
    â”‚  â””â”€ Route requires 'applicant' middleware
    â”‚
    â–¼
MIDDLEWARE INTERCEPTS
    â”‚
    â”œâ”€ ApplicantMiddleware checks:
    â”‚  â”œâ”€ auth()->check() = true âœ“
    â”‚  â”œâ”€ auth()->user()->isApplicant() = false âœ—
    â”‚
    â–¼
REDIRECT WITH ERROR
    â”‚
    â”œâ”€ return redirect('/')->with('error', 'You must be an applicant...')
    â”‚
    â–¼
USER SEES ERROR MESSAGE
    â”‚
    â””â”€ Flash message displayed on home page

UNAUTHORIZED POLICY CHECK
    â”‚
    â”œâ”€ Employer tries to accept application for another employer's job
    â”‚  â”œâ”€ $this->authorize('hire', $application)
    â”‚
    â–¼
POLICY EVALUATION
    â”‚
    â”œâ”€ JobApplicationPolicy::hire() checks:
    â”‚  â”œâ”€ $user->isAdmin() = false
    â”‚  â”œâ”€ $user->isEmployer() = true âœ“
    â”‚  â”œâ”€ $application->job->company->user_id === $user->id = false âœ—
    â”‚  â””â”€ return false
    â”‚
    â–¼
THROW EXCEPTION
    â”‚
    â”œâ”€ AuthorizationException thrown
    â”‚
    â–¼
HTTP 403 RESPONSE
    â”‚
    â”œâ”€ Response code: 403 Forbidden
    â”‚ -Error message: "This action is unauthorized."
    â”‚
    â–¼
USER SEES ERROR PAGE
    â””â”€ 403 Forbidden - Access Denied page
```

---

## Security Layers Summary

```
LAYER 1: ROUTE PROTECTION
â”œâ”€ Public routes (no protection)
â”œâ”€ Authenticated routes (auth required)
â””â”€ Role-specific routes (role middleware)

LAYER 2: MIDDLEWARE CHECK
â”œâ”€ Is user authenticated?
â”œâ”€ Does user have required role?
â””â”€ Is user's account active?

LAYER 3: POLICY AUTHORIZATION
â”œâ”€ Does user own the resource?
â”œâ”€ Is the resource in correct state?
â””â”€ Does user have granular permission?

LAYER 4: BUSINESS LOGIC
â”œâ”€ Additional validation checks
â”œâ”€ Data integrity verification
â””â”€ Error handling and logging

LAYER 5: DATABASE
â”œâ”€ Role enum constraints
â”œâ”€ Foreign key relationships
â””â”€ Ownership tracking via user_id
```

---

## Quick Role Decision Tree

```
USER WANTS TO...

â”œâ”€ Browse jobs?
â”‚  â””â”€ âœ… Anyone (no role restriction)
â”‚
â”œâ”€ Apply for a job?
â”‚  â”œâ”€ Are you logged in?
â”‚  â”‚  â”œâ”€ NO â†’ Login required
â”‚  â”‚  â””â”€ YES â†’ Continue
â”‚  â”œâ”€ Is your role 'applicant'?
â”‚  â”‚  â”œâ”€ NO â†’ Upgrade to applicant
â”‚  â”‚  â””â”€ YES â†’ Continue
â”‚  â”œâ”€ Is your email verified?
â”‚  â”‚  â”œâ”€ NO â†’ Verify email first
â”‚  â”‚  â””â”€ YES â†’ âœ… PROCEED
â”‚  â””â”€ âŒ BLOCKED
â”‚
â”œâ”€ Post a job?
â”‚  â”œâ”€ Are you logged in?
â”‚  â”‚  â”œâ”€ NO â†’ Login required
â”‚  â”‚  â””â”€ YES â†’ Continue
â”‚  â”œâ”€ Is your role 'employer' or 'admin'?
â”‚  â”‚  â”œâ”€ NO â†’ Upgrade to employer
â”‚  â”‚  â””â”€ YES â†’ Continue
â”‚  â”œâ”€ Do you have a company profile?
â”‚  â”‚  â”œâ”€ NO â†’ Create company first
â”‚  â”‚  â””â”€ YES â†’ âœ… PROCEED
â”‚  â””â”€ âŒ BLOCKED
â”‚
â””â”€ Access admin panel?
   â”œâ”€ Are you logged in?
   â”‚  â”œâ”€ NO â†’ Login required
   â”‚  â””â”€ YES â†’ Continue
   â”œâ”€ Is your role 'admin'?
   â”‚  â”œâ”€ NO â†’ Not authorized
   â”‚  â””â”€ YES â†’ âœ… PROCEED
   â””â”€ âŒ BLOCKED
```

---

**Diagrams Version:** 1.0  
**Last Updated:** December 2, 2025  
**Status:** Complete
